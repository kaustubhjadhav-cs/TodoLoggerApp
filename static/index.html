<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Task Tracker</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%2358a6ff'/><stop offset='100%25' style='stop-color:%23bc8cff'/></linearGradient></defs><rect width='100' height='100' rx='20' fill='url(%23g)'/><path d='M25 50 L40 65 L75 30' stroke='white' stroke-width='10' stroke-linecap='round' stroke-linejoin='round' fill='none'/></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-card: #1c2128;
            --border-color: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent-green: #3fb950;
            --accent-green-bg: rgba(63, 185, 80, 0.15);
            --accent-orange: #f0883e;
            --accent-orange-bg: rgba(240, 136, 62, 0.15);
            --accent-red: #f85149;
            --accent-red-bg: rgba(248, 81, 73, 0.15);
            --accent-blue: #58a6ff;
            --accent-blue-bg: rgba(88, 166, 255, 0.15);
            --accent-purple: #bc8cff;
            --accent-purple-bg: rgba(188, 140, 255, 0.15);
            --shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] {
            --bg-primary: #f6f8fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0f3f6;
            --bg-card: #ffffff;
            --border-color: #d0d7de;
            --text-primary: #1f2328;
            --text-secondary: #656d76;
            --text-muted: #8c959f;
            --accent-green: #1a7f37;
            --accent-green-bg: rgba(26, 127, 55, 0.12);
            --accent-orange: #bc4c00;
            --accent-orange-bg: rgba(188, 76, 0, 0.12);
            --accent-red: #cf222e;
            --accent-red-bg: rgba(207, 34, 46, 0.12);
            --accent-blue: #0969da;
            --accent-blue-bg: rgba(9, 105, 218, 0.12);
            --accent-purple: #8250df;
            --accent-purple-bg: rgba(130, 80, 223, 0.12);
            --shadow: 0 8px 24px rgba(140, 149, 159, 0.2);
            --shadow-sm: 0 2px 8px rgba(140, 149, 159, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Background pattern - dark mode */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(88, 166, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(188, 140, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(63, 185, 80, 0.03) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
            transition: background 0.3s ease;
        }

        /* Background pattern - light mode */
        [data-theme="light"] body::before,
        body:has([data-theme="light"])::before {
            background: 
                radial-gradient(circle at 20% 20%, rgba(9, 105, 218, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(130, 80, 223, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(26, 127, 55, 0.04) 0%, transparent 70%);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(90deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
        }

        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-family: 'Outfit', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
        }

        .btn-ghost:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .btn-success {
            background: var(--accent-green);
            color: white;
        }

        .btn-danger {
            background: var(--accent-red);
            color: white;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8125rem;
        }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Date Navigation */
        .date-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .date-display {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: var(--bg-secondary);
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .date-display input[type="date"] {
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            cursor: pointer;
        }

        .date-display input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }

        [data-theme="light"] .date-display input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
        }

        .today-badge {
            background: var(--accent-green-bg);
            color: var(--accent-green);
            padding: 0.25rem 0.625rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Task Board */
        .task-board {
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .board-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .board-title {
            font-size: 1.125rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.625rem;
        }

        .task-count {
            background: var(--accent-blue-bg);
            color: var(--accent-blue);
            padding: 0.125rem 0.5rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Add Task Form */
        .add-task-form {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 0.75rem;
        }

        .add-task-form input {
            flex: 1;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9375rem;
            transition: border-color 0.2s;
        }

        .add-task-form input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .add-task-form input::placeholder {
            color: var(--text-muted);
        }

        /* Task List */
        .task-list {
            padding: 0.75rem;
            min-height: 300px;
            max-height: calc(100vh - 400px);
            overflow-y: auto;
        }

        .task-list::-webkit-scrollbar {
            width: 6px;
        }

        .task-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .task-list::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 0.875rem;
            padding: 1rem;
            background: var(--bg-card);
            border-radius: 10px;
            margin-bottom: 0.5rem;
            border: 1px solid transparent;
            transition: all 0.2s ease;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-item:hover {
            border-color: var(--border-color);
        }

        .task-item.completed {
            opacity: 0.6;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .task-checkbox {
            width: 22px;
            height: 22px;
            border-radius: 6px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .task-checkbox:hover {
            border-color: var(--accent-green);
        }

        .task-checkbox.checked {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        .task-checkbox.checked::after {
            content: '‚úì';
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .task-content {
            flex: 1;
            min-width: 0;
        }

        .task-title {
            font-size: 0.9375rem;
            font-weight: 500;
            margin-bottom: 0.375rem;
            word-wrap: break-word;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
        }

        .task-tag {
            font-size: 0.6875rem;
            padding: 0.1875rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
            font-family: 'JetBrains Mono', monospace;
        }

        .tag-date {
            background: var(--accent-blue-bg);
            color: var(--accent-blue);
        }

        .tag-drag {
            background: var(--accent-orange-bg);
            color: var(--accent-orange);
        }

        .tag-drag.high {
            background: var(--accent-red-bg);
            color: var(--accent-red);
        }

        .tag-completed {
            background: var(--accent-green-bg);
            color: var(--accent-green);
        }

        .task-actions {
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .task-item:hover .task-actions {
            opacity: 1;
        }

        .task-action-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .task-action-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .task-action-btn.delete:hover {
            background: var(--accent-red-bg);
            color: var(--accent-red);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .empty-state p {
            font-size: 0.875rem;
        }

        /* Sidebar - Historical Logs */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .stats-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 1.5rem;
        }

        .stats-title {
            font-size: 0.8125rem;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-value.green { color: var(--accent-green); }
        .stat-value.orange { color: var(--accent-orange); }
        .stat-value.blue { color: var(--accent-blue); }
        .stat-value.purple { color: var(--accent-purple); }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Historical Logs */
        .history-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            flex: 1;
        }

        .history-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }

        .history-header h3 {
            font-size: 0.9375rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.2s;
        }

        .history-item:hover {
            background: var(--bg-tertiary);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-date {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.375rem;
        }

        .history-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
        }

        .history-stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .history-stat.completed { color: var(--accent-green); }
        .history-stat.pending { color: var(--accent-orange); }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-log-task {
            padding: 0.875rem;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-log-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .modal-log-status.completed {
            background: var(--accent-green);
        }

        .modal-log-status.pending {
            background: var(--accent-orange);
        }

        .modal-log-title {
            flex: 1;
            font-size: 0.9375rem;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: var(--shadow);
            animation: toastIn 0.3s ease;
            min-width: 280px;
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success { border-left: 3px solid var(--accent-green); }
        .toast.error { border-left: 3px solid var(--accent-red); }
        .toast.info { border-left: 3px solid var(--accent-blue); }

        .toast-icon {
            font-size: 1.125rem;
        }

        .toast-message {
            flex: 1;
            font-size: 0.875rem;
        }

        /* Theme Toggle */
        .theme-toggle {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .theme-toggle:hover {
            background: var(--border-color);
            transform: scale(1.05);
        }

        .theme-toggle .icon {
            transition: all 0.3s ease;
        }

        .theme-toggle .sun-icon {
            position: absolute;
            opacity: 0;
            transform: rotate(90deg) scale(0);
        }

        .theme-toggle .moon-icon {
            opacity: 1;
            transform: rotate(0) scale(1);
        }

        [data-theme="light"] .theme-toggle .sun-icon {
            opacity: 1;
            transform: rotate(0) scale(1);
        }

        [data-theme="light"] .theme-toggle .moon-icon {
            opacity: 0;
            transform: rotate(-90deg) scale(0);
        }

        /* Smooth transitions for theme change */
        body,
        .app-container,
        .task-board,
        .task-item,
        .sidebar,
        .stats-card,
        .history-card,
        .modal,
        .btn,
        .date-display,
        input {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
            }

            .date-nav {
                flex-wrap: wrap;
            }

            .add-task-form {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="logo">
                <div class="logo-icon">üìã</div>
                <h1>Daily Task Tracker</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="rolloverTasks()">
                    üîÑ Rollover Pending
                </button>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                    <span class="icon moon-icon">üåô</span>
                    <span class="icon sun-icon">‚òÄÔ∏è</span>
                </button>
            </div>
        </header>

        <div class="main-content">
            <main class="main-panel">
                <div class="date-nav">
                    <button class="btn btn-ghost" onclick="navigateDate(-1)">‚Üê Prev</button>
                    <div class="date-display">
                        <input type="date" id="currentDate" onchange="loadTasksForDate(this.value)">
                        <span id="todayBadge" class="today-badge" style="display: none;">Today</span>
                    </div>
                    <button class="btn btn-ghost" onclick="navigateDate(1)">Next ‚Üí</button>
                    <button class="btn btn-secondary btn-sm" onclick="goToToday()">Today</button>
                </div>

                <div class="task-board">
                    <div class="board-header">
                        <h2 class="board-title">
                            <span>Tasks</span>
                            <span class="task-count" id="taskCount">0</span>
                        </h2>
                    </div>

                    <form class="add-task-form" onsubmit="addTask(event)">
                        <input type="text" id="newTaskInput" placeholder="What needs to be done?" autocomplete="off">
                        <button type="submit" class="btn btn-primary">Add Task</button>
                    </form>

                    <div class="task-list" id="taskList">
                        <div class="empty-state">
                            <div class="empty-state-icon">‚ú®</div>
                            <h3>No tasks for this day</h3>
                            <p>Add a task above to get started</p>
                        </div>
                    </div>
                </div>
            </main>

            <aside class="sidebar">
                <div class="stats-card">
                    <h3 class="stats-title">Today's Progress</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value green" id="completedCount">0</div>
                            <div class="stat-label">Completed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value orange" id="pendingCount">0</div>
                            <div class="stat-label">Pending</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value blue" id="totalCount">0</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value purple" id="draggedCount">0</div>
                            <div class="stat-label">Dragged</div>
                        </div>
                    </div>
                </div>

                <div class="history-card">
                    <div class="history-header">
                        <h3>üìÖ Historical Logs</h3>
                    </div>
                    <div class="history-list" id="historyList">
                        <!-- History items will be populated here -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal-overlay" id="historyModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Tasks for Date</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Global state
        let currentDate = new Date().toISOString().split('T')[0];
        let tasks = [];

        // Theme management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            setTheme(theme);
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            document.getElementById('currentDate').value = currentDate;
            updateTodayBadge();
            loadTasksForDate(currentDate);
            loadHistoricalDates();
        });

        // Date navigation
        function navigateDate(days) {
            const date = new Date(currentDate);
            date.setDate(date.getDate() + days);
            currentDate = date.toISOString().split('T')[0];
            document.getElementById('currentDate').value = currentDate;
            updateTodayBadge();
            loadTasksForDate(currentDate);
        }

        function goToToday() {
            currentDate = new Date().toISOString().split('T')[0];
            document.getElementById('currentDate').value = currentDate;
            updateTodayBadge();
            loadTasksForDate(currentDate);
        }

        function updateTodayBadge() {
            const today = new Date().toISOString().split('T')[0];
            const badge = document.getElementById('todayBadge');
            badge.style.display = currentDate === today ? 'inline' : 'none';
        }

        // Load tasks for a specific date
        async function loadTasksForDate(date) {
            currentDate = date;
            updateTodayBadge();
            
            try {
                const response = await fetch(`/api/daily-log?date=${date}`);
                const log = await response.json();
                tasks = log.tasks || [];
                renderTasks();
                updateStats(log);
            } catch (error) {
                showToast('Failed to load tasks', 'error');
            }
        }

        // Render tasks
        function renderTasks() {
            const taskList = document.getElementById('taskList');
            document.getElementById('taskCount').textContent = tasks.length;

            if (tasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ú®</div>
                        <h3>No tasks for this day</h3>
                        <p>Add a task above to get started</p>
                    </div>
                `;
                return;
            }

            taskList.innerHTML = tasks.map(task => `
                <div class="task-item ${task.is_completed ? 'completed' : ''}" data-id="${task.id}">
                    <div class="task-checkbox ${task.is_completed ? 'checked' : ''}" 
                         onclick="toggleTask(${task.id}, ${!task.is_completed})"></div>
                    <div class="task-content">
                        <div class="task-title">${escapeHtml(task.title)}</div>
                        <div class="task-meta">
                            ${task.is_completed 
                                ? `<span class="task-tag tag-completed">‚úì Completed</span>`
                                : `<span class="task-tag tag-date">üìÖ ${formatDate(task.assigned_date)}</span>`
                            }
                            ${!task.is_completed && task.drag_days > 0 
                                ? `<span class="task-tag tag-drag ${task.drag_days >= 3 ? 'high' : ''}">‚è± Dragged ${task.drag_days} day${task.drag_days > 1 ? 's' : ''}</span>`
                                : ''
                            }
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="task-action-btn delete" onclick="deleteTask(${task.id})" title="Delete">üóë</button>
                    </div>
                </div>
            `).join('');
        }

        // Update statistics
        function updateStats(log) {
            const completed = log.completed_count || 0;
            const pending = log.pending_count || 0;
            const total = completed + pending;
            const dragged = (log.tasks || []).filter(t => !t.is_completed && t.drag_days > 0).length;

            document.getElementById('completedCount').textContent = completed;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('draggedCount').textContent = dragged;
        }

        // Add task
        async function addTask(event) {
            event.preventDefault();
            const input = document.getElementById('newTaskInput');
            const title = input.value.trim();

            if (!title) return;

            try {
                const response = await fetch('/api/tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, date: currentDate })
                });

                if (response.ok) {
                    input.value = '';
                    loadTasksForDate(currentDate);
                    loadHistoricalDates();
                    showToast('Task added successfully', 'success');
                }
            } catch (error) {
                showToast('Failed to add task', 'error');
            }
        }

        // Toggle task completion
        async function toggleTask(id, completed) {
            try {
                const response = await fetch(`/api/tasks/${id}/complete`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ is_completed: completed })
                });

                if (response.ok) {
                    loadTasksForDate(currentDate);
                    loadHistoricalDates();
                    showToast(completed ? 'Task completed!' : 'Task reopened', 'success');
                }
            } catch (error) {
                showToast('Failed to update task', 'error');
            }
        }

        // Delete task
        async function deleteTask(id) {
            if (!confirm('Are you sure you want to delete this task?')) return;

            try {
                const response = await fetch(`/api/tasks/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    loadTasksForDate(currentDate);
                    loadHistoricalDates();
                    showToast('Task deleted', 'info');
                }
            } catch (error) {
                showToast('Failed to delete task', 'error');
            }
        }

        // Rollover tasks - moves ALL pending tasks from any past date to today
        async function rolloverTasks() {
            try {
                const response = await fetch('/api/rollover-all', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                if (response.ok) {
                    loadTasksForDate(currentDate);
                    loadHistoricalDates();
                    if (result.tasks_moved > 0) {
                        showToast(`${result.tasks_moved} task(s) rolled over to today`, 'success');
                    } else {
                        showToast('No pending tasks to rollover', 'info');
                    }
                }
            } catch (error) {
                showToast('Failed to rollover tasks', 'error');
            }
        }

        // Load historical dates
        async function loadHistoricalDates() {
            try {
                const response = await fetch('/api/dates');
                const dates = await response.json();
                renderHistory(dates);
            } catch (error) {
                console.error('Failed to load history');
            }
        }

        // Render history sidebar
        async function renderHistory(dates) {
            const historyList = document.getElementById('historyList');
            
            if (!dates || dates.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state" style="padding: 2rem 1rem;">
                        <p style="font-size: 0.875rem;">No historical data yet</p>
                    </div>
                `;
                return;
            }

            // Get stats for each date
            const historyItems = await Promise.all(dates.slice(0, 10).map(async date => {
                try {
                    const response = await fetch(`/api/daily-log?date=${date}`);
                    const log = await response.json();
                    return { date, ...log };
                } catch {
                    return { date, completed_count: 0, pending_count: 0 };
                }
            }));

            historyList.innerHTML = historyItems.map(item => `
                <div class="history-item" onclick="showHistoryModal('${item.date}')">
                    <div class="history-date">${formatDateFull(item.date)}</div>
                    <div class="history-stats">
                        <span class="history-stat completed">‚úì ${item.completed_count || 0} done</span>
                        <span class="history-stat pending">‚óã ${item.pending_count || 0} pending</span>
                    </div>
                </div>
            `).join('');
        }

        // Show history modal
        async function showHistoryModal(date) {
            try {
                const response = await fetch(`/api/daily-log?date=${date}`);
                const log = await response.json();
                
                document.getElementById('modalTitle').textContent = `Tasks for ${formatDateFull(date)}`;
                
                const tasks = log.tasks || [];
                if (tasks.length === 0) {
                    document.getElementById('modalBody').innerHTML = `
                        <div class="empty-state" style="padding: 2rem;">
                            <p>No tasks recorded for this day</p>
                        </div>
                    `;
                } else {
                    document.getElementById('modalBody').innerHTML = tasks.map(task => `
                        <div class="modal-log-task">
                            <div class="modal-log-status ${task.is_completed ? 'completed' : 'pending'}"></div>
                            <div class="modal-log-title">${escapeHtml(task.title)}</div>
                            ${!task.is_completed && task.drag_days > 0 
                                ? `<span class="task-tag tag-drag">${task.drag_days}d</span>`
                                : ''
                            }
                        </div>
                    `).join('');
                }

                document.getElementById('historyModal').classList.add('active');
            } catch (error) {
                showToast('Failed to load history', 'error');
            }
        }

        function closeModal() {
            document.getElementById('historyModal').classList.remove('active');
        }

        // Close modal on overlay click
        document.getElementById('historyModal').addEventListener('click', (e) => {
            if (e.target.id === 'historyModal') closeModal();
        });

        // Utility functions
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function formatDateFull(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
            
            if (dateStr === today) return 'Today';
            if (dateStr === yesterday) return 'Yesterday';
            
            return date.toLocaleDateString('en-US', { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric',
                year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Toast notifications
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = { success: '‚úì', error: '‚úï', info: '‚Ñπ' };
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <span class="toast-message">${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
            
            // Focus input with '/' key
            if (e.key === '/' && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                document.getElementById('newTaskInput').focus();
            }

            // Toggle theme with 't' key
            if (e.key === 't' && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                toggleTheme();
            }
        });
    </script>
</body>
</html>

